<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test D√©taill√© de la G√©n√©ration de Tokens</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #1e1e1e; color: #d4d4d4; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .success { color: #4ade80; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        .result { background: #2d2d2d; padding: 10px; margin: 10px 0; border-radius: 3px; font-size: 12px; }
        button { background: #007acc; color: white; border: none; padding: 10px 15px; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background: #005aa3; }
        #console { background: #000; color: #00ff00; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test D√©taill√© - G√©n√©ration de Tokens</h1>

        <div class="section">
            <h3>Configuration du test</h3>
            <label>Couleur: <input type="color" id="testColor" value="#007ACC"></label>
            <label>Naming: <select id="testNaming">
                <option value="custom">Custom</option>
                <option value="shadcn">ShadCN</option>
                <option value="tailwind">Tailwind</option>
            </select></label>
            <br><br>
            <button id="testIndividual">Tester chaque fonction individuellement</button>
            <button id="testComplete">Tester g√©n√©ration compl√®te</button>
            <button id="clearConsole">Effacer console</button>
        </div>

        <div class="section">
            <h3>R√©sultats d√©taill√©s</h3>
            <div id="results"></div>
        </div>

        <div class="section">
            <h3>Console de d√©bogage</h3>
            <div id="console"></div>
        </div>
    </div>

    <script src="code.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');
        const consoleDiv = document.getElementById('console');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(`[${type}] ${message}`);
        }

        function testFunction(name, fn, ...args) {
            log(`üîç Testing ${name}(${args.join(', ')})...`, 'info');

            try {
                const start = Date.now();
                const result = fn(...args);
                const duration = Date.now() - start;

                log(`‚úÖ ${name} completed in ${duration}ms`, 'success');

                if (result === undefined) {
                    log(`‚ùå ${name} returned undefined!`, 'error');
                    return undefined;
                }

                if (result === null) {
                    log(`‚ùå ${name} returned null!`, 'error');
                    return null;
                }

                if (typeof result === 'object') {
                    const keys = Object.keys(result);
                    log(`üìä ${name} returned object with ${keys.length} keys: [${keys.join(', ')}]`, 'info');

                    if (keys.length === 0) {
                        log(`‚ö†Ô∏è ${name} returned empty object!`, 'warning');
                    }
                } else {
                    log(`üìä ${name} returned: ${result} (type: ${typeof result})`, 'info');
                }

                return result;
            } catch (error) {
                log(`‚ùå ${name} ERROR: ${error.message}`, 'error');
                console.error(error);
                return null;
            }
        }

        document.getElementById('testIndividual').addEventListener('click', () => {
            const color = document.getElementById('testColor').value;
            const naming = document.getElementById('testNaming').value;

            resultsDiv.innerHTML = '<h4>Test de chaque fonction individuellement</h4>';

            log('üöÄ Starting individual function tests...', 'info');

            // Test des fonctions utilitaires d'abord
            log('Testing utility functions...', 'info');
            testFunction('hexToRgb', hexToRgb, color);
            testFunction('hexToHsl', hexToHsl, color);
            testFunction('hslToHex', hslToHex, 210, 100, 50); // Bleu

            // Test des fonctions de g√©n√©ration
            log('Testing token generation functions...', 'info');
            const brandResult = testFunction('generateBrandColors', generateBrandColors, color, naming);
            const systemResult = testFunction('generateSystemColors', generateSystemColors, naming);
            const grayResult = testFunction('generateGrayscale', generateGrayscale, naming);
            const spacingResult = testFunction('generateSpacing', generateSpacing, naming);
            const radiusResult = testFunction('generateRadius', generateRadius, naming);
            const typographyResult = testFunction('generateTypography', generateTypography, naming);
            const borderResult = testFunction('generateBorder', generateBorder);

            // R√©sum√©
            const results = {
                brand: brandResult,
                system: systemResult,
                gray: grayResult,
                spacing: spacingResult,
                radius: radiusResult,
                typography: typographyResult,
                border: borderResult
            };

            const failed = Object.entries(results).filter(([key, value]) => value === null || value === undefined || (typeof value === 'object' && Object.keys(value).length === 0));

            if (failed.length > 0) {
                log(`‚ùå ${failed.length} functions failed or returned empty results: ${failed.map(([k]) => k).join(', ')}`, 'error');
            } else {
                log('‚úÖ All functions returned valid results!', 'success');
            }

            resultsDiv.innerHTML += '<div class="result">' + JSON.stringify(results, null, 2) + '</div>';
        });

        document.getElementById('testComplete').addEventListener('click', () => {
            const color = document.getElementById('testColor').value;
            const naming = document.getElementById('testNaming').value;

            resultsDiv.innerHTML = '<h4>Test de g√©n√©ration compl√®te (simulant le plugin)</h4>';

            log('üöÄ Starting complete token generation test...', 'info');

            try {
                // Simuler exactement ce qui se passe dans le plugin
                const resolvedNaming = naming && naming.trim() !== "" ? naming : "custom";
                log(`üìù Resolved naming: "${naming}" -> "${resolvedNaming}"`, 'info');

                const tokens = {
                    brand: generateBrandColors(color, resolvedNaming),
                    system: generateSystemColors(resolvedNaming),
                    gray: generateGrayscale(resolvedNaming),
                    spacing: generateSpacing(resolvedNaming),
                    radius: generateRadius(resolvedNaming),
                    typography: generateTypography(resolvedNaming),
                    border: generateBorder()
                };

                log('‚úÖ Token generation completed', 'success');

                // V√©rifier chaque cat√©gorie
                let totalTokens = 0;
                Object.entries(tokens).forEach(([category, tokenSet]) => {
                    if (!tokenSet || typeof tokenSet !== 'object') {
                        log(`‚ùå Category ${category} is invalid: ${tokenSet}`, 'error');
                    } else {
                        const count = Object.keys(tokenSet).length;
                        totalTokens += count;
                        log(`‚úÖ Category ${category}: ${count} tokens`, 'success');

                        if (count === 0) {
                            log(`‚ö†Ô∏è Category ${category} is empty!`, 'warning');
                        }
                    }
                });

                log(`üìä Total tokens generated: ${totalTokens}`, totalTokens > 0 ? 'success' : 'error');

                if (totalTokens === 0) {
                    log('‚ùå CRITICAL: No tokens were generated at all!', 'error');
                }

                resultsDiv.innerHTML += '<div class="result">' + JSON.stringify(tokens, null, 2) + '</div>';

            } catch (error) {
                log(`‚ùå Complete generation failed: ${error.message}`, 'error');
                console.error(error);
            }
        });

        document.getElementById('clearConsole').addEventListener('click', () => {
            consoleDiv.innerHTML = '';
        });

        // Test automatique au chargement
        setTimeout(() => {
            log('üéØ Test page loaded. Click buttons to test token generation.', 'info');
        }, 500);
    </script>
</body>
</html>