<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Animation Slide-Out</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden; /* Simule le problème */
        }

        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.15s ease;
        }

        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
        }

        button:hover {
            background: #0056b3;
        }

        .debug {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Debug Animation Slide-Out</h1>
    <button onclick="testSlideAnimation()">Tester l'animation corrigée</button>

    <div class="container" id="container">
        <div class="card" id="card1" data-indices="[0]">Carte 1 - Index 0</div>
        <div class="card" id="card2" data-indices="[1]">Carte 2 - Index 1</div>
    </div>

    <div class="debug" id="debugOutput">Console de debug...</div>

    <script>
        let debugOutput = document.getElementById('debugOutput');

        function log(message) {
            console.log(message);
            debugOutput.textContent += '\n' + message;
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }

        function testSlideAnimation() {
            debugOutput.textContent = '=== DÉBUT TEST ANIMATION ===';
            log('[DEBUG] testSlideAnimation appelée');

            // Simuler les paramètres reçus
            var appliedCount = 1;
            var error = null;
            var index = 0; // Tester avec l'index 0

            if (appliedCount > 0) {
                var cards = document.querySelectorAll('.card');
                log('[DEBUG] Nombre de cartes trouvées: ' + cards.length);
                var targetCard = null;

                cards.forEach(function (card, cardIndex) {
                    var cardIndices = JSON.parse(card.getAttribute('data-indices') || '[]');
                    log('[DEBUG] Carte ' + cardIndex + ' indices: ' + JSON.stringify(cardIndices) + ' contient index? ' + cardIndices.includes(index));
                    if (cardIndices.includes(index)) {
                        targetCard = card;
                        log('[DEBUG] Carte cible trouvée: ' + targetCard.id + ' avec indices: ' + JSON.stringify(cardIndices));
                    }
                });

                if (targetCard) {
                    log('[DEBUG] opacity: ' + targetCard.style.opacity + ' display: ' + targetCard.style.display);

                    if (targetCard.style.opacity !== '0' && targetCard.style.display !== 'none') {
                        log('[DEBUG] Conditions remplies, lancement de l\'animation');

                        var parentContainer = targetCard.closest('.container') || targetCard.parentElement;
                        var originalOverflow = parentContainer ? parentContainer.style.overflow : '';
                        log('[DEBUG] Container trouvé: ' + (parentContainer ? parentContainer.id || parentContainer.className : 'aucun') + ' overflow original: ' + originalOverflow);

                        targetCard.style.transition = 'all 0.15s ease';
                        targetCard.style.backgroundColor = 'rgba(34, 197, 94, 0.1)';
                        targetCard.style.borderColor = 'rgba(34, 197, 94, 0.3)';
                        log('[DEBUG] Animation de succès appliquée (vert)');

                        setTimeout(function() {
                            log('[DEBUG] Début de l\'animation slide-out');

                            if (parentContainer) {
                                parentContainer.style.overflow = 'visible';
                                log('[DEBUG] Overflow changé à visible');
                            }

                            targetCard.style.transition = 'transform 0.4s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.4s ease';
                            targetCard.style.transform = 'translateX(100vw)';
                            targetCard.style.opacity = '0';
                            log('[DEBUG] Transform appliqué: ' + targetCard.style.transform);

                            setTimeout(function () {
                                log('[DEBUG] Fin de l\'animation, nettoyage');

                                if (parentContainer) {
                                    parentContainer.style.overflow = originalOverflow;
                                    log('[DEBUG] Overflow restauré à: ' + originalOverflow);
                                }

                                targetCard.style.display = 'none';
                                targetCard.style.transform = '';
                                targetCard.style.opacity = '1';
                                log('[DEBUG] Carte cachée avec display: none');

                                log('[DEBUG] === TEST TERMINÉ ===');
                            }, 400);
                        }, 150);
                    }
                }
            }
        }
    </script>
</body>
</html>
